"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const TestRunnerDecorator_1 = require("./TestRunnerDecorator");
/**
 * Wraps a test runner and implements the retry functionality.
 */
class MaxTestRunnerReuseDecorator extends TestRunnerDecorator_1.default {
    constructor(testRunnerProducer, options) {
        super(testRunnerProducer);
        this.runs = 0;
        this.restartAfter = options.maxTestRunnerReuse || 0;
    }
    async mutantRun(options) {
        this.runs++;
        if (this.restartAfter > 0 && this.runs > this.restartAfter) {
            await this.recover();
            this.runs = 1;
        }
        return super.mutantRun(options);
    }
    async recover() {
        await this.dispose();
        this.createInnerRunner();
        return this.init();
    }
    dispose() {
        this.runs = 0;
        return super.dispose();
    }
}
exports.default = MaxTestRunnerReuseDecorator;
//# sourceMappingURL=MaxTestRunnerReuseDecorator.js.map